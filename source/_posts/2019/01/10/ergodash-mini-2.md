---
title: サイレントでホットスワップなErgoDash miniを制作(後編)
date: 2019-01-10 23:37:02
thumbnail: /gallery/thumbnails/ergodash-mini2.jpg
categories:
    - [DIY, Keyboard]
tags:
    - Keyboard
    - ErgoDash
---

2018年のキーボード納めとして、年末にErgoDash miniを組みました。この記事はその後編にあたります。前編は以下になります。

{% post_link ergodash-mini-1 %}

<!-- more -->

## 目次

<!-- toc -->

## 制作工程

前回はUndergrow LEDの取り付けまで行いました。今回はいよいよPro Microとキースイッチのホットスワップ化に挑みます。

### Pro Micro用のコンスルーの取り付け

Pro Microのホットスワップ化[^1]ですが、これはなるべく行っておいたほうがよいです。理由は前述のとおりモゲる心配もありますし、初期不良でPro Microが動作しないこともあります。基盤にはんだ付けすると後で剥がすのが非常に大変です。Pro Microのホットスワップ化の方法は主に２つあって、{% elink コンスルー(スプリングピンヘッダ) https://yushakobo.jp/shop/a01mc-00/ %}を用いる方法と、ソケットを用いる方法です。今回はコンスルーを利用しました。コンスルーはピンの部分がバネのような構造になっており、基盤部分にはんだ付けしなくてもスルーホールと密着する仕組みになっています。ただし、コンスルーとPro Microのはんだ付けは必要なようです。コンスルー利用時の注意点としては、コンスルー自体に向きがあることです。

{% blockquote Helixビルドガイドより https://github.com/MakotoKurauchi/helix/blob/master/Doc/buildguide_jp.md　引用元 %}
{% img https://camo.githubusercontent.com/c05368781c4341d65f5405ba7ae7d0c1babf2438/68747470733a2f2f692e696d6775722e636f6d2f4779414555336c2e6a7067 400 %}
{% endblockquote %}

向きを間違えると基盤から抜けやすくなったり接触不良になりやすいので、Helixのビルドガイドを参考に取り付けをしました。

[^1]: ここで言うホットスワップ化とは、はんだ付けせずにパーツを交換できる仕組みを指しています。電源を入れたまま抜き差しできるという意味ではないです。詳しくは{% elink ここ https://scrapbox.io/self-made-kbds-ja/%E3%83%9B%E3%83%83%E3%83%88%E3%82%B9%E3%83%AF%E3%83%83%E3%83%97 %}を参照してください。

### ホットスワップ用ベリリウムの取り付け

ここからがようやくキースイッチのホットスワップ化の話です。キースイッチのホットスワップ化する方法も主に２つあり、スルーホールに{% elink ベリリウム銅 https://www.digikey.jp/product-detail/ja/mill-max-manufacturing-corp/7305-0-15-15-47-27-10-0/ED1039-ND/1765737 %}を埋め込む方法と{% elink スイッチ用PCBソケット https://yushakobo.jp/shop/a01ps/ %}を利用する方法です。後者は基盤やケースの対応が必要になるので、今回は「みんな大好きベリリウム」[^2]を使います。

{% img /gallery/daily/keyboards/switch-socket.jpg 400 %}

ベリリウムは上記の写真のとおり非常に小さな金属です。写真右下ののキースイッチに実際にベリリウムを嵌めていいますが、上の方の足のベリリウムは非常に硬かったので最初下の足だけピンセットでベリリウムを嵌めて、もう一つのベリリウムは基盤のスルーホールに嵌めてからスイッチを垂直に挿すようにして嵌めました。このとき大事なのはベリリウムの穴に対してちゃんと狙って真上から力をかけることです。スイッチの足は折れやすいので斜めに力を掛けるとすぐに穴に入らずグニャリと逝ってしまわれます[^3]。このベリリウムを挿す作業は非常に辛い作業で一部の人々には「田植え」とも呼ばれていますが、基盤から生え揃った金色の稲穂を眼前にすれば目頭が熱くなること必死です(笑)。

{% img /gallery/daily/keyboards/golden-rice.jpg 400 %}

ErgoDash miniではこの段階で親指付近のキーの物理配置を決定しますが、せっかくホットスワップにしたのでキーの足が入る全てのスルーホールにベリリウムを埋め込んでおくことをオススメします。こうすることで後ではんだ付けすることなくキーの物理配置を変更することができます。実際にキーマップをいじっていると物理配置をいじりたくなる瞬間が何回かあってホットスワップにしておいてよかったと実感できました。

さて、この田植え作業が終わったと思って一息つけるかと思えば、そうは問屋が卸しません・・・組立工程の屈指の難関、ベリリウムのはんだ付けです。このはんだ付けの何が難しいかと言えば、基盤から顔を覗かせているベリリウムの高さがあまりないので、ベリリウムの穴にはんだが入らないように周囲にだけはんだを盛るのが大変なのです。単にスイッチの足をはんだ付けすればいいのであれば、一つの足に付き数秒で済みますが、ベリリウムの周囲をはんだが入らないように固めるとすれば、はんだを数回に分けて慎重に盛らねばなりません。自分の場合、普通にスイッチにはんだ付けするより5倍程の時間がかかりました・・・[^4]

[^2]: {% elink 出典 http://nillpo.hatenablog.com/entry/2018/02/25/022158 %}
[^3]: この作業でスイッチを2個ダメにしました・・・
[^4]: 一回失敗してベリリウムの穴にはんだを入れてしまいました。5倍の時間というのは失敗したベリリウムを基盤から剥がす時間込みです。やっちまった瞬間は地獄に落とされたような感覚でした・・・

### スタビライザー、キースイッチ、Pro Microの取り付け

ホットスワップにしたのでここからは基盤に挿すだけのお仕事です。ただスタビライザーを取り付ける場合には静音化のためにグリスをしっかり塗りましょう。自分は手元にあったシリコングリスを塗りました。オイル系だとあまり音を抑えられなかったのでここはグリスがいい感じでした。キースイッチは足が曲がらないように慎重にベリリウムを狙って挿すようにしましょう。Pro Microは基盤に挿すだけなのですが、Pro Microに着いているLEDは光量があって透明のアクリルケースだと拡散して結構目立ちます。気になる人は不透明な絶縁テープで目張りをすることをオススメします。下の写真では左が目張りをしていて、右が目張りをしていません。

{% img /gallery/daily/keyboards/pro-micro-light.jpg 300 %}

USBの口と反対側にライトがあるのでここにテープを貼ります。この写真では赤色のLEDしか目張りしていませんが、緑色のLEDも気になる場合は全体に貼りましょう。

{% img /gallery/daily/keyboards/pro-micro-tape.jpg 300 %}

### Pro MicroにQMK Firmwareの書き込み

この作業は公式のビルドガイドどおりで大丈夫です・・・といっても公式もリンクで実際はQMK Firmwareのページにもろもろ書いてあります。とりあえずGMK Firmwareの環境構築は終わっているものとして、骨子だけ説明します。ターミナルを開いて以下の手順で実施すれば大丈夫です。

```bash
cd <QMK Firmwareのトップディレクトリ>
cp -r keyboards/ergodash/mini/keymaps/default keyboards/ergodash/mini/keymaps/hinastory # デフォルトのキーマップをコピーして自分専用のものを作る
emacs -nw keyboards/ergodash/mini/keymaps/hinastory/rules.mk # 「RGBLIGHT_ENABLE = yes」を追加
emacs -nw keyboards/ergodash/mini/keymaps/hinastory/keymap.c # お好きなキーマップに変更
sudo make ergodash/mini:hinastory # ファームウェアのビルドと転送。
```

上記で「hinastory」の部分は適当に好きな名前にしてください。自分のオリジナルのキーマップになるはずなのでユーザ名にしておくとわかりやすいです。emacsの部分はお好きなエディタに読み替えてください。Backlight LEDを有効にするためにはrule.mkに「RGBLIGHT_ENABLE = yes」を追加する必要があります。ファームウェアのビルドの転送に関してはコマンド実行後に以下のメッセージが表示されたら、PCと片側のキーボードをUSBケーブルでつないで、キーボードのリセットスイッチを押してください。この作業時にはTRRSケーブルは抜いておいてください。もう片側も同様にファームウェアの転送が必要です。

```
Detecting USB port, reset your controller now...
```

### 動作確認

おめでとうございます！
ここまでの作業でマスターにUSBケーブルをつなぎ、左右のキーボードをTRRSケーブル[^5]で繋げはキーボードは光り、全てのキーが入力できるはずです。動作に問題があった方はご愁傷様です・・・ケースを組む前にトラブルシューティングにお進みください・・・[^6]

[^5]: TRSケーブルだとマスターの反対側のLEDが光りません。片側しかLEDがつかなかったらケーブルを疑ってみてください。
[^6]: 当然自分もトラブルシューティングに進みました・・・なのでトラブルシューティングの節は体験談です・・・orz

### ケースの組み立て

ケース組み立てはビルドガイドの通りにアクリルプレートをネジ止めすれば大丈夫です。問題はキーボードに傾斜をつけたい場合です。もともとErgodash miniにはPro Microのスペースを確保するために手前から奥にかけて軽めの傾斜が付いていますが、もう少し奥側を高くしたい場合はゴム足で調整するのが簡単です。

{% img /gallery/daily/keyboards/tilt.jpg 500 %}

上記の写真右がキーボードの手前側で写真左がキーボードの奥側になります。手前に着いている小さいゴム足がキットに付属しているもので、奥側の少し大きめのゴム足が追加で購入したものです。ゴム足は色々なサイズのものがあるので好みの大きさを購入してください。Ergodash miniはコンパクトなキーボードなのでこのくらいの傾斜が自分にはちょうどよかったです。また、キーボードの中央と外側で高さを変えたい場合もゴム足の高さを変えることで調整できます。

### キーキャップの取り付け 〜O-ringによる静音化〜

いよいよ最後にキーキャップを取り付け作業です。自作キーボードの制作の中でも屈指の楽しい作業です。まずは手持ちのキーキャップを机に並べる所から始めましょう。自分はピラミッドを組みました(笑)。キーキャップはキースイッチに適合したものであれば何でもよいです。一般的にはCherry MX互換スイッチが大多数なのでCherry MX対応のキーキャップから揃えることをオススメします。今回使ったGateron SilentスイッチもCherry MX互換のスイッチだったので、大量のキーキャップとキャッキャウフフしながら、キーボードの着せ替えを楽しみました。まさに至福のひとときです。

{% img /gallery/daily/keyboards/keycap.jpg 300 %}

どのキーキャップをつけるか決めたら最後に静音化の一手間をかけます。前編で説明したO-ringです。今回はグループバイ(共同購入)した3mm O-ringを装着しました。O-ringの大きさや素材によって静音性は変わるので好みのものを選んでください。

{% img /gallery/daily/keyboards/o-ring.jpg 300 %}

取り付け方は簡単で上記の写真のようにキーキャップの裏の足に嵌めるだけです。2uのキーキャップには3箇所嵌める必要があります。

### 完成!

お疲れ様でした。完成です！

{% img /gallery/daily/keyboards/ergodash-mini.jpg 500 %}

## トラブルシューティング

今回自分が体験したトラブルはダイオードの挿し忘れ、LEDのはんだ不良、ベリリウムの穴にはんだ流し込み、ベリリウムのはんだ忘れ、スイッチの足にベリリムを嵌めようとしてスイッチの足を壊す、スタビライザーつけ忘れ、TRSケーブルとTRRSケーブルの間違い・・・
書いてて自分はアホの子ではないかとおもうくらいやらかしています・・・orz
ただこれはみんな通る道だと信じています・・・
以下のリンク先にこれらのトラブルの原因と対処方法がまとまっているのでご確認ください。ここに自分が体験したほぼ全てのトラブルが記載してありました。本当にいい情報なのでまとめてくれた人に感謝です。自分が自作キーボードを始めた頃にこのページはなかったのが悔やまれます・・・

{%  linkPreview https://scrapbox.io/self-made-kbds-ja/%E3%82%AD%E3%83%BC%E3%83%9C%E3%83%BC%E3%83%89%E3%82%92%E7%B5%84%E3%81%BF%E7%AB%8B%E3%81%A6%E3%82%8B%E3%81%A8%E3%81%8D%E3%81%AB%E9%99%A5%E3%82%8B%E3%83%9F%E3%82%B9%E3%81%A8%E5%AF%BE%E7%AD%96 %}

上記のページで解決しない場合は{% elink Discode https://discordapp.com/invite/NM7XtDW %}で質問しましょう。「#ergodash」という専用チャンネルもありますし、自作キーボードの入門的な質問なら「#beginner-help」でもいいでしょう。親切な人が多いのできっと誰かが手を差し伸べてくれるはずです[^7]。

ここからはトラブルの傾向に対する自分の感想ですが、やはりいちばんの関門はキットやパーツの入手性の悪さですね。人気のキットはすぐに売り切れますし、グループバイ(共同購入)の情報も様々な情報を注視していないと拾えないです。最近は大分改善されましたが、一昨年まではまともに組もうとすると海外通販を避けて通れない状態でした。しかし、去年はコミケやTokyo Maker Fairや技術書店にいけばキットを購入でき、Boothでも手に入りやすい状態でした。今年はもうすぐ遊舎工房さんの実店舗が秋葉原にオープンするらしいので、入手性に関してはさらに改善される見込みです。次の鬼門ははんだ付けですね。特にPro Microのはんだ不良は結構耳にします。またダイオードやPro Microを逆付けしてはんだを剥がそうとして基盤を壊す人もそこそこいます。またLEDチップの実装は阿鼻叫喚の様相を呈しています。

あとはQMK Firmwareですね。苦労のタイプは大きく２つあって、QMK Firmwareそのものに苦戦する場合とQMK FIrmwareにたどり着く前の前提知識で苦戦する場合です。前者はQMK Firmwareのどこをいじればキーマップを思い通りにできるか悩む場合でドキュメントを読んである程度試行錯誤しないといけないでしょう。後者はそもそもビルド環境の構築やGit操作やC言語やmakeの仕組みの理解が足りなくて苦労しています。自分は前者の苦労だけで済んだので比較的楽でしたが、後者で苦労している人も多そうですね。残念ながらこの辺の苦労話を書くのはここの余白は狭すぎます・・・[^8]

[^7]: 自分も1台目のときにお世話になりました。このときははんだ不良で貼り付けた写真にいろいろな人にアドバイスを頂きました。
[^8]: {% post_link keymap %} を書きました。

## ホットスワップ化の長所と短所

最後にホットスワップ化の作業について、自分が感じたProsとConsをまとめてみたいとおもいます。

- Pro Micoのホットスワップ化(コンスルー利用時)
  - Pros
    - モゲ対策になる
    - 初期不良対策になる
  - Cons
    - コンスルーの購入にお金がかかる
    - コンスルーの向きに注意が必要
- スイッチのホットスワップ化(ベリリウム利用時)
  - Pros
    - スイッチを自由に変えられる
    - ケースを後から変えられる
    - キーの物理配置を後から変えられる(ErgoDash等の一部のPCBのみ)
  - Cons
    - ベリリウム高い・・・
    - ベリリウムの入手性が若干悪い
    - 田植えが辛すぎる・・・
    - キーキャップを引き抜くときに、一緒にキースイッチも抜ける場合がある

Pro Microに関しては特に言うことないですね。大抵の人にオススメできると思います。スイッチのホットスワップ化は本当に人を選びます。とにかくお金と慎重さと忍耐が必要です。一旦ホットスワップ化をしてしまえば当然最高の気分になれます。特に末永くキーボードを使っていくとなると、後でキースイッチを変えたり、lubeをやり直したくなったりしますがこれをいつでもできるという安心感はすごいですね。ケースもスイッチをはんだ付けするとトッププレートはかえられませんが、これもスイッチを引き抜けると簡単に交換可能になります。あと最初は意識していなかったキーの物理配置を後から簡単に変えられるのも地味に嬉しかったです。

キースイッチのホットスワップ化後の注意点には、キーキャップを引き抜くときにキースイッチも抜ける場合があります。これはケースやキーキャップの装着部分のきつさにもよるのですが、自分の場合何もしないと3つに一つはキースイッチも一緒に抜けます。対策としてはキーキャップ引き抜き器(針金タイプのもの)の一つを治具代わりにして、キースイッチの上部を押さえて、２本めのキーキャップ引き抜き器でキーキャップを抜いています。

{% img /gallery/daily/keyboards/pull-keycap.jpg 250 %}

## まとめ

まず、静音化ですがこれは体感でかなり変わりました。もちろん人によって評価は変わると思いますが、静かな会議室で利用しても問題ないくらいにはなったと感じています。また打ち心地に関してもlubeのおかげで大分なめらかになって、疲れにくくなったと感じました。ホットスワップ化に関しては、特にスイッチの作業自体は苦労しましたが一度壁を超えてしまえば恐れることはないし、その後に得られるものも大きいので次回のキーボード制作でも採用したいと思います。

最初は本当に静音化とホットスワップ化のことだけについて書く予定でしたが、書いている途中で色々盛り込みたくなって結局、前半、後半に分けても長い記事になってしまいました。本当にここまで読んで頂いてありがとうございました。この記事が読んでくれた方の自作キーボードの一助となれば幸いです。