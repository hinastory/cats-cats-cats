<!doctype html>
<html lang="ja"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>Contextual Abstractionsで様々なコンテキストをうまく抽象化する - cats cats cats</title><link rel="manifest" href="/cats-cats-cats/manifest.json"><meta name="application-name" content="cats cats cats"><meta name="msapplication-TileImage" content="/favicon.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="cats cats cats"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="プログラミングでは様々な「コンテキスト」を扱う必要が出てきます。コンテキストをうまく扱えないと冗長な記述が必要になったり、コンテキストが複雑になりすぎて混乱を招いたりします。特にコンテキストの引き回しは様々なプログラミング言語やフレームワークで出てくるパターンですが、安易に使うと複雑性、冗長性の増大や密結合等さまざまな問題を引き起こすことが知られています。しかしScala 3の目玉機能であるCon"><meta property="og:type" content="article"><meta property="og:title" content="Contextual Abstractionsで様々なコンテキストをうまく抽象化する"><meta property="og:url" content="https://hinastory.github.io/cats-cats-cats/2021/03/16/contextual-abstructions/"><meta property="og:site_name" content="cats cats cats"><meta property="og:description" content="プログラミングでは様々な「コンテキスト」を扱う必要が出てきます。コンテキストをうまく扱えないと冗長な記述が必要になったり、コンテキストが複雑になりすぎて混乱を招いたりします。特にコンテキストの引き回しは様々なプログラミング言語やフレームワークで出てくるパターンですが、安易に使うと複雑性、冗長性の増大や密結合等さまざまな問題を引き起こすことが知られています。しかしScala 3の目玉機能であるCon"><meta property="og:locale" content="ja_JP"><meta property="og:image" content="https://hinastory.github.io/cats-cats-cats/gallery/thumbnails/eiga_film.png"><meta property="article:published_time" content="2021-03-15T22:28:45.000Z"><meta property="article:modified_time" content="2021-03-20T00:53:18.674Z"><meta property="article:author" content="hinastory"><meta property="article:tag" content="Scala"><meta property="article:tag" content="Dotty"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/cats-cats-cats/gallery/thumbnails/eiga_film.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hinastory.github.io/cats-cats-cats/2021/03/16/contextual-abstructions/"},"headline":"cats cats cats","image":["https://hinastory.github.io/cats-cats-cats/gallery/thumbnails/eiga_film.png"],"datePublished":"2021-03-15T22:28:45.000Z","dateModified":"2021-03-20T00:53:18.674Z","author":{"@type":"Person","name":"hinastory"},"description":"プログラミングでは様々な「コンテキスト」を扱う必要が出てきます。コンテキストをうまく扱えないと冗長な記述が必要になったり、コンテキストが複雑になりすぎて混乱を招いたりします。特にコンテキストの引き回しは様々なプログラミング言語やフレームワークで出てくるパターンですが、安易に使うと複雑性、冗長性の増大や密結合等さまざまな問題を引き起こすことが知られています。しかしScala 3の目玉機能であるCon"}</script><link rel="canonical" href="https://hinastory.github.io/cats-cats-cats/2021/03/16/contextual-abstructions/"><link rel="alternate" href="/cats-cats-cats/cats-cats-cats/atom.xml" title="cats cats cats" type="application/atom+xml"><link rel="icon" href="/cats-cats-cats/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/vs2015.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/cats-cats-cats/css/default.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><!--!--><!--!--><script src="https://www.googletagmanager.com/gtag/js?id=UA-132406459-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-132406459-1');</script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><meta name="generator" content="Hexo 5.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/cats-cats-cats/"><img src="/cats-cats-cats/gallery/profile/cats-cats-cats-logo.png" alt="cats cats cats" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/cats-cats-cats/"><i class="fa fa-home mr-1"></i> Home</a><a class="navbar-item" href="/cats-cats-cats/archives"><i class="fas fa-archive fa-fw mr-1"></i> Archives</a><a class="navbar-item" href="/cats-cats-cats/categories"><i class="fas fa-cat fa-fw mr-1"></i> Categories</a><a class="navbar-item" href="/cats-cats-cats/tags"><i class="fas fa-tags fa-fw mr-1"></i> Tags</a><a class="navbar-item" href="/cats-cats-cats/about"><i class="undefined mr-1"></i> About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目次" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="検索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><h1 class="title is-3 is-size-4-mobile">Contextual Abstractionsで様々なコンテキストをうまく抽象化する</h1><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><span class="level-item"><i class="mr-1 fas fa-calendar-alt"></i><span>2021-03-16</span></span><span class="level-item"><i class="mr-1 fas fa-cat"></i><a class="link-muted" href="/cats-cats-cats/categories/Tech/">Tech</a><span> / </span><a class="link-muted" href="/cats-cats-cats/categories/Tech/Language/">Language</a></span><span class="level-item"><i class="fas fa-tags"></i><span><a class="link-muted ml-1" rel="tag" href="/cats-cats-cats/tags/Scala/">Scala</a>, <a class="link-muted ml-1" rel="tag" href="/cats-cats-cats/tags/Dotty/">Dotty</a></span></span></div></div><div class="card-image"><span class="image is-7by3"><img class="cover-image" src="/cats-cats-cats/gallery/thumbnails/eiga_film.png"></span></div><div class="content"><p>プログラミングでは様々な「<code>コンテキスト</code>」を扱う必要が出てきます。コンテキストをうまく扱えないと冗長な記述が必要になったり、コンテキストが複雑になりすぎて混乱を招いたりします。特に<code>コンテキストの引き回し</code>は様々なプログラミング言語やフレームワークで出てくるパターンですが、安易に使うと複雑性、冗長性の増大や密結合等さまざまな問題を引き起こすことが知られています。しかしScala 3の目玉機能である<strong>Contextual Abstractions(コンテキスト抽象化)</strong> を使えばこの問題を鮮やかに解決できます。</p>
<p>本記事では<code>Contextual Abstractions</code>がなぜコンテキストをうまく扱うことができるのかを説明したいと思います。</p>
<a id="more"></a>

<h1 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h1><p>Scala 3で新しく <strong>「コンテキスト抽象化」</strong> という機能が入ります。この機能は従来の「<code>Implicits</code>」と呼ばれる機能を再設計し、さらに大幅に強化したものになっています。「コンテキスト抽象化」はScala 3を特徴付ける非常に魅力的な考え方なので、従来のScalaやImplicitsを知らない人でもなるべく分かるように説明したいと思います。</p>
<h1 id="コンテキスト抽象化の基本"><a href="#コンテキスト抽象化の基本" class="headerlink" title="コンテキスト抽象化の基本"></a>コンテキスト抽象化の基本</h1><p>コンテキスト抽象化の本質は <strong>「コンテキストの引き回し」に対するエレガントな回答</strong> であり、Scala 3の<code>using</code>句と<code>given</code>インスタンスの仕組みが大きな役割を果たしています。このことを次の節から順に説明していきます。</p>
<h2 id="コンテキスト"><a href="#コンテキスト" class="headerlink" title="コンテキスト"></a>コンテキスト</h2><p>コンテキストは日本語で書くと「<code>文脈</code>」になり、前後の繋がりや背景を意味します。プログラミングでは <strong>特定の範囲で有効な複数の処理で共通する情報</strong> をコンテキストとしてよく扱います。</p>
<p>変数名としてはよく<code>context</code>の省略形である<code>ctx</code>が用いられる場合が多いですが、その他にも<code>info</code>とか<code>config</code>等のもう少し用途を限定した名前が割り当てられる場合があります。</p>
<p>例えば以下の例ではコンテキストとして<code>ctx</code>という変数を用意し、コンテキストの情報として<code>"sunny"</code>を代入して複数回利用しています。</p>
<figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">val</span> ctx = <span class="hljs-string">"sunny"</span> <span class="hljs-comment">// コンテキストを準備</span><br>println(<span class="hljs-string">s"context is <span class="hljs-subst">${ctx}</span>"</span>) <span class="hljs-comment">// 最初のコンテキストの利用</span><br>someFunction(ctx) <span class="hljs-comment">// 2回目のコンテキストの利用</span><br></code></pre></td></tr></tbody></table></figure>
<p>上記の例ではコンテキストをローカルの変数として用意していますが、「コンテキスト」自体は情報の有効範囲や使われ方に対する性質を意味しているので、実際のコンテキストには様々なものが考えられます。</p>
<h2 id="コンテキストの引き回し"><a href="#コンテキストの引き回し" class="headerlink" title="コンテキストの引き回し"></a>コンテキストの引き回し</h2><p>シンプルなコンテキストは単一の関数のスコープ内で利用もできますが、一般的にはコンテキストを関数の間で受け渡して <strong>複数の関数でコンテキストを共有する用途</strong> でよく利用されます。これを<strong>コンテキストの引き回し</strong> といいます。</p>
<p>以下の例ではコンテキスト<code>ctx</code>を親関数から孫関数まで引き回しています。</p>
<figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">// 親関数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parentFunction</span></span>() =<br>  <span class="hljs-keyword">val</span> ctx = <span class="hljs-string">"sunny"</span> <span class="hljs-comment">// コンテキストの生成</span><br>  println(<span class="hljs-string">s"parent func: ctx=<span class="hljs-subst">${ctx}</span>"</span>)<br>  childFunction(ctx) <span class="hljs-comment">// コンテキストの引き回し</span><br><br><span class="hljs-comment">// 子関数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">childFunction</span></span>(ctx: <span class="hljs-type">String</span>) =<br>  println(<span class="hljs-string">"child func"</span>)<br>  grandchildFunction(ctx) <span class="hljs-comment">// コンテキストの引き回し **</span><br><br><span class="hljs-comment">// 孫関数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">grandchildFunction</span></span>(ctx: <span class="hljs-type">String</span>) =<br>  println(<span class="hljs-string">"grandchild func"</span>)<br>  println(<span class="hljs-string">s"It's <span class="hljs-subst">${ctx}</span> today."</span>) <span class="hljs-comment">// コンテキストの利用</span><br><br>parentFunction() <span class="hljs-comment">// 親関数の呼び出し</span><br></code></pre></td></tr></tbody></table></figure>
<p>コンテキストに複数の情報を持たせたい場合は専用の <strong>「型」</strong> を用意します。<br>以下は専用の<code>ContextA</code>という型を用意してコンテキストの情報を詰め込んでいます。</p>
<figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">// コンテキストを表す型を定義</span><br><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContextA</span>(<span class="hljs-params">weather: <span class="hljs-type">String</span>, year: <span class="hljs-type">Int</span></span>)</span><br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-comment">// 親関数</span></span><br><span class="hljs-class"><span class="hljs-title">def</span> <span class="hljs-title">parentFunction</span>(<span class="hljs-params"></span>) </span>=<br>  <span class="hljs-keyword">val</span> ctxA = <span class="hljs-type">ContextA</span>(<span class="hljs-string">"sunny"</span>, <span class="hljs-number">2021</span>) <span class="hljs-comment">// コンテキストの生成</span><br>  println(<span class="hljs-string">s"parent func: weather=<span class="hljs-subst">${ctxA.weather}</span>"</span>)<br>  childFunction(ctxA) <span class="hljs-comment">// コンテキストの引き回し</span><br><br><span class="hljs-comment">// 子関数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">childFunction</span></span>(ctxA: <span class="hljs-type">ContextA</span>) =<br>  println(<span class="hljs-string">s"child func: year=<span class="hljs-subst">${ctxA.year}</span>"</span>)<br>  grandchildFunction(ctxA) <span class="hljs-comment">// コンテキストの引き回し</span><br><br><span class="hljs-comment">// 孫関数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">grandchildFunction</span></span>(ctxA: <span class="hljs-type">ContextA</span>) =<br>  println(<span class="hljs-string">"grandchild func"</span>)<br>  println(<span class="hljs-string">s"It's <span class="hljs-subst">${ctxA.weather}</span> today."</span>) <span class="hljs-comment">// コンテキストの利用</span><br>  println(<span class="hljs-string">s"This year is <span class="hljs-subst">${ctxA.year}</span>"</span>) <span class="hljs-comment">// コンテキストの利用</span><br><br>parentFunction() <span class="hljs-comment">// 親関数の呼び出し</span><br></code></pre></td></tr></tbody></table></figure>
<p>図にすると以下のようになります。</p>
<img src="/cats-cats-cats/gallery/daily/others/ctx_abst_1.png" class="">

<p>コンテキストの型は非常に便利ですが、コンテキストに詰め込みたい情報が増えてくるとコンテキストに依存する関数の間に複雑な依存関係を生み出し、密結合となってしまいます。密結合の関数は単体テストやメンテナンスがしづらく非常に厄介です。</p>
<h2 id="コンテキストを型で分割する"><a href="#コンテキストを型で分割する" class="headerlink" title="コンテキストを型で分割する"></a>コンテキストを型で分割する</h2><p>前述のとおり一つのコンテキストに情報を詰め込みすぎると単体テストやメンテナンスが面倒になるので都合のいい単位で分割することにします。</p>
<p>以下の例では元々のコンテキストをContextAとContextBの２つに分割しています。そして<code>ctxB</code>は子関数と孫関数でしか使われないので、子関数で定義することにします。</p>
<figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">// コンテキストを表す型を定義</span><br><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContextA</span>(<span class="hljs-params">weather: <span class="hljs-type">String</span></span>)</span><br><span class="hljs-class"><span class="hljs-title">case</span> <span class="hljs-title">class</span> <span class="hljs-title">ContextB</span>(<span class="hljs-params">year: <span class="hljs-type">Int</span></span>)</span><br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-comment">// 親関数</span></span><br><span class="hljs-class"><span class="hljs-title">def</span> <span class="hljs-title">parentFunction</span>(<span class="hljs-params"></span>) </span>=<br>  <span class="hljs-keyword">val</span> ctxA = <span class="hljs-type">ContextA</span>(<span class="hljs-string">"sunny"</span>) <span class="hljs-comment">// コンテキスト`ctxA`の生成</span><br>  println(<span class="hljs-string">s"parent func: weather=<span class="hljs-subst">${ctxA.weather}</span>"</span>)<br>  childFunction(ctxA) <span class="hljs-comment">// コンテキストの引き回し</span><br><br><span class="hljs-comment">// 子関数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">childFunction</span></span>(ctxA: <span class="hljs-type">ContextA</span>) =<br>  <span class="hljs-keyword">val</span> ctxB = <span class="hljs-type">ContextB</span>(<span class="hljs-number">2021</span>) <span class="hljs-comment">// コンテキスト`ctxB`の生成</span><br>  println(<span class="hljs-string">s"child func: <span class="hljs-subst">${ctxB.year}</span>"</span>)<br>  grandchildFunction(ctxA, ctxB) <span class="hljs-comment">// コンテキストの引き回し</span><br><br><span class="hljs-comment">// 孫関数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">grandchildFunction</span></span>(ctxA: <span class="hljs-type">ContextA</span>, ctxB: <span class="hljs-type">ContextB</span>) =<br>  println(<span class="hljs-string">"grandchild func"</span>)<br>  println(<span class="hljs-string">s"It's <span class="hljs-subst">${ctxA.weather}</span> today."</span>)<br>  println(<span class="hljs-string">s"This year is <span class="hljs-subst">${ctxB.year}</span>"</span>)<br><br>parentFunction() <span class="hljs-comment">// 親関数の呼び出し</span><br></code></pre></td></tr></tbody></table></figure>
<p>図にすると以下のようになります。</p>
<img src="/cats-cats-cats/gallery/daily/others/ctx_abst_2.png" class="">

<h2 id="型によるコンテキストの特定-usingとgiven"><a href="#型によるコンテキストの特定-usingとgiven" class="headerlink" title="型によるコンテキストの特定(usingとgiven)"></a>型によるコンテキストの特定(<code>using</code>と<code>given</code>)</h2><p>ここからがScala 3に特化した内容になりますが、<code>using</code>句を使うと<code>コンテキストパラメータ</code>と呼ばれる特殊なパラメータを関数が受け取ることができるようになります。そしてコンテキストパラメータでは <strong>「型」</strong> を基準に<code>given</code> インスタンスをスコープ内で探して自動的に補完します。</p>
<p>以下の関数定義で<code>using</code>が使われている箇所がコンテキストパラメータになります。コンテキストパラメータはもし、スコープ内に同じ型の<code>given</code>インスタンスがあった場合に呼び出し時に省略可能です。</p>
<figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">childFunction</span></span>()(using ctxA: <span class="hljs-type">ContextA</span>)<br></code></pre></td></tr></tbody></table></figure>
<p>さて、ここまでの説明をもとにこれまでの親関数、子関数、孫関数を書き直すと以下のようになります。</p>
<figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">// コンテキストを表す型を定義</span><br><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContextA</span>(<span class="hljs-params">weather: <span class="hljs-type">String</span></span>)</span><br><span class="hljs-class"><span class="hljs-title">case</span> <span class="hljs-title">class</span> <span class="hljs-title">ContextB</span>(<span class="hljs-params">year: <span class="hljs-type">Int</span></span>)</span><br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-comment">// 親関数</span></span><br><span class="hljs-class"><span class="hljs-title">def</span> <span class="hljs-title">parentFunction</span>(<span class="hljs-params"></span>) </span>=<br>  given ctxA: <span class="hljs-type">ContextA</span> = <span class="hljs-type">ContextA</span>(<span class="hljs-string">"sunny"</span>) <span class="hljs-comment">// コンテキストの生成(`given`インスタンス)</span><br>  println(<span class="hljs-string">s"parent func: <span class="hljs-subst">${ctxA.weather}</span>"</span>)<br>  childFunction() <span class="hljs-comment">// コンテキストパラメータの省略（コンテキストの自動引き回し）</span><br><br><span class="hljs-comment">// 子関数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">childFunction</span></span>()(using ctxA: <span class="hljs-type">ContextA</span>) =<br>  given ctxB: <span class="hljs-type">ContextB</span> = <span class="hljs-type">ContextB</span>(<span class="hljs-number">2021</span>) <span class="hljs-comment">// コンテキストの生成(`given`インスタンス)</span><br>  println(<span class="hljs-string">s"child func: <span class="hljs-subst">${ctxB.year}</span>"</span>)<br>  grandchildFunction() <span class="hljs-comment">// コンテキストパラメータの省略(コンテキストの自動引き回し)</span><br><br><span class="hljs-comment">// 孫関数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">grandchildFunction</span></span>()(using ctxA: <span class="hljs-type">ContextA</span>)(using ctxB: <span class="hljs-type">ContextB</span>) =<br>  println(<span class="hljs-string">"grandchild func"</span>)<br>  println(<span class="hljs-string">s"It's <span class="hljs-subst">${ctxA.weather}</span> today."</span>)<br>  println(<span class="hljs-string">s"This year is <span class="hljs-subst">${ctxB.year}</span>"</span>)<br><br>  parentFunction() <span class="hljs-comment">// 親関数の呼び出し</span><br></code></pre></td></tr></tbody></table></figure>
<p>図にすると以下のようになります。<code>given</code>と<code>using</code>の対応に注目してください。</p>
<img src="/cats-cats-cats/gallery/daily/others/ctx_abst_3.png" class="">

<h3 id="usingとgivenにおける変数名の省略とsummonメソッド"><a href="#usingとgivenにおける変数名の省略とsummonメソッド" class="headerlink" title="usingとgivenにおける変数名の省略とsummonメソッド"></a><code>using</code>と<code>given</code>における変数名の省略と<code>summon</code>メソッド</h3><p><code>using</code>と<code>given</code>では変数名を省略して型名のみ記述することができます。この場合<code>summon</code>メソッドと型名を用いてインスタンスにアクセス可能です。<code>summon</code>は「召喚する」という意味で、省略された変数に格納されるはずだったインスタンスを強制的に「召喚」します。</p>
<figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">// コンテキストを表す型を定義</span><br><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContextA</span>(<span class="hljs-params">weather: <span class="hljs-type">String</span></span>)</span><br><span class="hljs-class"><span class="hljs-title">case</span> <span class="hljs-title">class</span> <span class="hljs-title">ContextB</span>(<span class="hljs-params">year: <span class="hljs-type">Int</span></span>)</span><br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-comment">// 親関数</span></span><br><span class="hljs-class"><span class="hljs-title">def</span> <span class="hljs-title">parentFunction</span>(<span class="hljs-params"></span>) </span>=<br>  given <span class="hljs-type">ContextA</span> = <span class="hljs-type">ContextA</span>(<span class="hljs-string">"sunny"</span>) <span class="hljs-comment">// コンテキストの生成(`given`インスタンス)</span><br>  println(<span class="hljs-string">s"parent func: <span class="hljs-subst">${summon[ContextA].weather}</span>"</span>)<br>  childFunction() <span class="hljs-comment">// コンテキストパラメータの省略（コンテキストの自動引き回し）</span><br><br><span class="hljs-comment">// 子関数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">childFunction</span></span>()(using <span class="hljs-type">ContextA</span>) =<br>  given <span class="hljs-type">ContextB</span> = <span class="hljs-type">ContextB</span>(<span class="hljs-number">2021</span>) <span class="hljs-comment">// コンテキストの生成(`given`インスタンス)</span><br>  println(<span class="hljs-string">s"child func: <span class="hljs-subst">${summon[ContextB].year}</span>"</span>)<br>  grandchildFunction() <span class="hljs-comment">// コンテキストパラメータの省略(コンテキストの自動引き回し)</span><br><br><span class="hljs-comment">// 孫関数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">grandchildFunction</span></span>()(using <span class="hljs-type">ContextA</span>)(using <span class="hljs-type">ContextB</span>) =<br>  println(<span class="hljs-string">"grandchild func"</span>)<br>  println(<span class="hljs-string">s"It's <span class="hljs-subst">${summon[ContextA].weather}</span> today."</span>)<br>  println(<span class="hljs-string">s"This year is <span class="hljs-subst">${summon[ContextB].year}</span>."</span>)<br><br>  parentFunction() <span class="hljs-comment">// 親関数の呼び出し</span><br></code></pre></td></tr></tbody></table></figure>
<p>一般的には<code>summon</code>メソッドを使うと記述が長くなるので、<code>summon</code>メソッドを使わなくて済む場合にだけ<code>using</code>や<code>given</code>の変数名を省略します。</p>
<p>例えば上記の子関数の場合、元々の関数宣言は<code>def childFunction()(using ctxA: ContextA)</code>でした。しかし<code>ctxA</code>は子関数では利用されず、そのまま<code>grandchildFunction</code>に引き回されて省略されたコンテキストパラメータに補給されるだけなので、省略が正解です。</p>
<p>しかし子関数の<code>ContextB</code>に関してはその後すぐに<code>summon[ContextB].year</code>で利用しており元の<code>ctxB.year</code>の方が短く簡潔になるので、省略しないほうが良かったと考えられます。</p>
<h2 id="コンテキスト抽象化"><a href="#コンテキスト抽象化" class="headerlink" title="コンテキスト抽象化"></a>コンテキスト抽象化</h2><p>コンテキスト抽象化の基本的なアイデアは前節で説明した<code>given</code>と<code>using</code>に集約されています。具体的には以下の4つからなります。</p>
<ol>
<li>コンテキストを「型」として定義</li>
<li>コンテキストを受け取る関数を定義(<code>using</code>句)</li>
<li>コンテキストの生成(<code>given</code>インスタンス)</li>
<li>コンテキストを受け取る関数の呼び出し（コンテキストの自動引き回し）</li>
</ol>
<p>コンテキスト抽象化の本質はこの4つのステップが分離されていて、コンテキストの有効範囲がコントロールされているということです。分離されているということは別々のファイルで定義されてもいいということであり、有効範囲がコントロールされているというのは、直接定義されたスコープかインポートしたスコープの範囲でしかコンテキストが有効にならないこと意味しています。</p>
<p>それでは具体的にファイルを分割して、コンテキストがうまく抽象化されてきちんと制御されていることを確認します。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scala:MyContextDefs.scala">package MyContextDefs<br>// コンテキストを表す型を定義<br>case class ContextA(weather: String)<br>case class ContextB(year: Int)<br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs scala:MyFunctionsA.scala">package MyFunctionsA<br><br>import MyContextDefs.*<br>import MyFunctionsB.*<br><br>// 親関数<br>def parentFunction() =<br>  import MyContextValues.given // `given`インスタンスのインポート<br>  println(s"parent func: ${ctxA.weather}")<br>  childFunction() // コンテキストパラメータの省略（コンテキストの自動引き回し）<br><br>// 子関数<br>def childFunction()(using ctxA: ContextA) =<br>  import MyContextValues.given // `given`インスタンスのインポート<br>  println(s"child func: ${ctxB.year}")<br>  grandchildFunction() // コンテキストパラメータの省略(コンテキストの自動引き回し)<br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scala:MyFunctionsB.scala">package MyFunctionsB<br><br>import MyContextDefs.*<br><br>// 孫関数<br>def grandchildFunction()(using ctxA: ContextA)(using ctxB: ContextB) =<br>  println("grandchild func")<br>  println(s"It's ${ctxA.weather} today.")<br>  println(s"This year is ${ctxB.year}")<br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs scala:MyContextValues.scala">package MyContextValues<br><br>import MyContextDefs.*<br><br>given ctxA: ContextA = ContextA("sunny") // コンテキストの生成(`given`インスタンス)<br>given ctxB: ContextB = ContextB(2021) // コンテキストの生成(`given`インスタンス)<br></code></pre></td></tr></tbody></table></figure>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scala:Main.scala">@main def example: Unit =<br>  import MyFunctionsA._<br><br>  parentFunction() // 親関数の呼び出し<br></code></pre></td></tr></tbody></table></figure>
<p><code>import</code>ベースの各ファイルの依存関係を図にすると以下のようになります。</p>
<img src="/cats-cats-cats/gallery/daily/others/ctx_abst_4.png" class="">

<p>コンテキスト抽象化を行うと上記のように、<strong>各ファイルが疎結合になり修正による影響範囲を抑えることができます</strong>。またどの<code>given</code>インスタンスをインポートするかを選択可能になるので<strong>カスタマイズの柔軟性が飛躍的に向上します</strong>。これはライブラリの作成者とライブラリの利用者の両者に福音だと思います。また当然ですがコンテキストパラメータの省略により冗長な記述が避けられるのも大きなメリットです。</p>
<h1 id="コンテキスト抽象化の高度な機能"><a href="#コンテキスト抽象化の高度な機能" class="headerlink" title="コンテキスト抽象化の高度な機能"></a>コンテキスト抽象化の高度な機能</h1><p>次の節からはコンテキスト抽象化の高度な機能として<strong>拡張メソッド</strong>と<strong>型クラス</strong>の２つの機能を紹介します。</p>
<h2 id="特定の型にコンテキストを追加する（拡張メソッド）"><a href="#特定の型にコンテキストを追加する（拡張メソッド）" class="headerlink" title="特定の型にコンテキストを追加する（拡張メソッド）"></a>特定の型にコンテキストを追加する（拡張メソッド）</h2><p>コンテキスト抽象化の高度な機能として拡張メソッドがあります。拡張メソッドを使えば既存の型に修正を加えることなくメソッドを追加できます。</p>
<p>もちろん無制限に追加できるわけではなくて型の制約と有効範囲が存在するので、考え方はコンテキスト抽象化の発展的なものと捉えることが可能です。</p>
<p>具体的には<code>extension</code>キーワードを用いて型を拡張します。例えば以下の例では<code>Person</code>という型に<code>extension</code>キーワード<code>でprofile</code>というメソッドを拡張しています。</p>
<figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">// 型を定義</span><br><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>(<span class="hljs-params">name: <span class="hljs-type">String</span>, age: <span class="hljs-type">Int</span></span>)</span><br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-comment">// 型Personに対して拡張メソッドを定義</span></span><br><span class="hljs-class"><span class="hljs-title">extension</span> (<span class="hljs-params">p: <span class="hljs-type">Person</span></span>)</span><br><span class="hljs-class">  <span class="hljs-title">def</span> <span class="hljs-title">profile</span></span>: <span class="hljs-type">String</span> = <span class="hljs-string">s"Name: <span class="hljs-subst">${p.name}</span>, Age: <span class="hljs-subst">${p.age}</span>"</span><br><br><span class="hljs-keyword">val</span> alexa = <span class="hljs-type">Person</span>(<span class="hljs-string">"Alexa"</span>, <span class="hljs-number">12</span>)<br>println(alexa.profile)<br></code></pre></td></tr></tbody></table></figure>
<p>上記のように<code>profile</code>メソッドを定義するのに直接<code>Person</code>クラスを修正する必要はありません。このおかげで<code>Person</code>を利用している他の箇所には影響はありません。影響があるのは<code>extension</code>で定義した拡張メソッドのスコープ内のみになります。</p>
<p>オブジェクト指向における<code>継承</code>とも異なる事に注意する必要があります。拡張メソッドと継承のどちらも既存の型にメソッドを追加することができますが、継承は以下のように新たな型(<code>サブクラス</code>)を定義するため追加したメソッドを呼ぶためにはサブクラスのインスタンスを生成してメソッドを呼び出す必要があります。</p>
<figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">// 継承を用いた方法</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SubPerson</span>(<span class="hljs-params">name: <span class="hljs-type">String</span>, age: <span class="hljs-type">Int</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">Person</span>(<span class="hljs-params">name: <span class="hljs-type">String</span>, age: <span class="hljs-type">Int</span></span>)</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">profile</span></span>: <span class="hljs-type">String</span> = <span class="hljs-string">s"Name: <span class="hljs-subst">${name}</span>, Age: <span class="hljs-subst">${age}</span>"</span><br><br><span class="hljs-keyword">val</span> alexa2 = <span class="hljs-type">SubPerson</span>(<span class="hljs-string">"Alexa"</span>, <span class="hljs-number">12</span>)<br></code></pre></td></tr></tbody></table></figure>
<p>オブジェクト指向の継承と拡張メソッドの違いを図にすると以下のようになります。</p>
<img src="/cats-cats-cats/gallery/daily/others/ctx_abst_5.png" class="">

<p>上記のように拡張メソッドは既存の型を継承して新しい型を作成するわけではないので、<code>is-a</code>関係なども気にする必要はなくなります。</p>
<h2 id="特定のコンテキストを持つ「型」を定義する（型クラス）"><a href="#特定のコンテキストを持つ「型」を定義する（型クラス）" class="headerlink" title="特定のコンテキストを持つ「型」を定義する（型クラス）"></a>特定のコンテキストを持つ「型」を定義する（型クラス）</h2><p>拡張メソッドでは特定の型を拡張できましたが、時には複数の型に共通するメソッドのシグネチャを定義してそのメソッドの実装は型ごとに行いたい場合があります。このような機能は「型クラス」<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>と呼ばれています。</p>
<p>以下の例では<code>Person</code>と<code>Japanese</code>というふたつの型に対して、<code>CanGreet</code>という型クラスを実装しています。この例でも前述の拡張メソッドと同じく<code>Person</code>/<code>Japanese</code>と<code>CanGreet</code>の間に継承関係は存在しません。</p>
<figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">// 型を定義</span><br><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>(<span class="hljs-params">name: <span class="hljs-type">String</span>, age: <span class="hljs-type">Int</span></span>) <span class="hljs-comment">// 一般的な人</span></span><br><span class="hljs-class"><span class="hljs-title">case</span> <span class="hljs-title">class</span> <span class="hljs-title">Japanese</span>(<span class="hljs-params">name: <span class="hljs-type">String</span>, age: <span class="hljs-type">Int</span>, info: <span class="hljs-type">String</span></span>) <span class="hljs-comment">// 日本人</span></span><br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-comment">// それぞれの型に共通するメソッドを定義(型クラス)</span></span><br><span class="hljs-class"><span class="hljs-title">trait</span> <span class="hljs-title">CanGreet</span>[<span class="hljs-type">A</span>]</span>: <span class="hljs-comment">// 挨拶可能な型クラス</span><br>  extension (a: <span class="hljs-type">A</span>) <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hello</span></span>(): <span class="hljs-type">Unit</span><br><br><span class="hljs-comment">// それぞれの型に共通するメソッドに対する固有の実装</span><br>given <span class="hljs-type">CanGreet</span>[<span class="hljs-type">Person</span>] <span class="hljs-keyword">with</span><br>  extension(a: <span class="hljs-type">Person</span>) <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hello</span></span>() = println(<span class="hljs-string">"hello!"</span>)<br><br><span class="hljs-comment">// それぞれの型に共通するメソッドに対する固有の実装</span><br>given <span class="hljs-type">CanGreet</span>[<span class="hljs-type">Japanese</span>] <span class="hljs-keyword">with</span><br>  extension(a: <span class="hljs-type">Japanese</span>) <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hello</span></span>() = println(<span class="hljs-string">s"こんにちは。実はわたしは、<span class="hljs-subst">${a.info}</span>なんです。"</span>)<br><br><span class="hljs-keyword">val</span> alexa = <span class="hljs-type">Person</span>(<span class="hljs-string">"Alexa"</span>, <span class="hljs-number">12</span>)<br><span class="hljs-keyword">val</span> hanako = <span class="hljs-type">Japanese</span>(<span class="hljs-string">"Hanako"</span>, <span class="hljs-number">18</span>, <span class="hljs-string">"テニスが趣味"</span>)<br><br>alexa.hello() <span class="hljs-comment">// Hello!</span><br>hanako.hello() <span class="hljs-comment">// こんにちは。実はわたしは、テニスが趣味なんです。</span><br></code></pre></td></tr></tbody></table></figure>


<p>型クラスの考え方を図にすると以下のようになります。</p>
<img src="/cats-cats-cats/gallery/daily/others/ctx_abst_6.png" class="">

<p>重要なのは型クラスの実装はベースの型に対して固有になるということです。このためベースの型を後付で柔軟に拡張することができます。このような性質は <strong>アドホック多相性</strong> とも呼ばれており、HaskellやRustやSwift等でも利用できる汎用的な概念です。</p>
<p>前述の拡張メソッドと型クラスの大きな違いは <strong>拡張メソッドは単一の型を拡張することができますが、型クラスは複数の型を拡張できる</strong> という点です。 もちろん拡張メソッドも頑張れば個々の型を同じように拡張できますが拡張メソッドが同じインターフェースをもつことをコンパイラが保証できないので、その点が型クラスが必要な理由となります。つまり <strong>「型クラス」は「型」に対するインターフェースの役割を果たしている</strong> ということができます。</p>
<h3 id="型クラスを受け取る関数"><a href="#型クラスを受け取る関数" class="headerlink" title="型クラスを受け取る関数"></a>型クラスを受け取る関数</h3><p>関数を定義する場合、<code>using</code>を利用したコンテキストパラメータを以前に紹介しましたが、コンテキストパラメータでは型クラスも受け取ることができます。</p>
<p>以下のコードは型クラス「CanGreet」をコンテキストパラメータとして受け取る<code>greeting</code>関数を定義しています。</p>
<figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>(<span class="hljs-params">name: <span class="hljs-type">String</span>, age: <span class="hljs-type">Int</span></span>)</span><br><span class="hljs-class"><span class="hljs-title">case</span> <span class="hljs-title">class</span> <span class="hljs-title">Japanese</span>(<span class="hljs-params">name: <span class="hljs-type">String</span>, age: <span class="hljs-type">Int</span>, info: <span class="hljs-type">String</span></span>)</span><br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-title">trait</span> <span class="hljs-title">CanGreet</span>[<span class="hljs-type">A</span>]</span>:<br>  extension (a: <span class="hljs-type">A</span>) <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hello</span></span>(): <span class="hljs-type">Unit</span><br><br>given <span class="hljs-type">CanGreet</span>[<span class="hljs-type">Person</span>] <span class="hljs-keyword">with</span><br>  extension(a: <span class="hljs-type">Person</span>) <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hello</span></span>() = println(<span class="hljs-string">"hello!"</span>)<br><br>given <span class="hljs-type">CanGreet</span>[<span class="hljs-type">Japanese</span>] <span class="hljs-keyword">with</span><br>  extension(a: <span class="hljs-type">Japanese</span>) <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hello</span></span>() = println(<span class="hljs-string">s"こんにちは。実はわたしは、<span class="hljs-subst">${a.info}</span>なんです。"</span>)<br><br><span class="hljs-comment">// 型クラスCanGreetのインスタンスを受け取る関数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">greeting</span></span>[<span class="hljs-type">T</span>](a: <span class="hljs-type">T</span>)(using <span class="hljs-type">CanGreet</span>[<span class="hljs-type">T</span>]) = a.hello()<br><br><span class="hljs-keyword">val</span> alexa = <span class="hljs-type">Person</span>(<span class="hljs-string">"Alexa"</span>, <span class="hljs-number">12</span>)<br><span class="hljs-keyword">val</span> hanako = <span class="hljs-type">Japanese</span>(<span class="hljs-string">"Hanako"</span>, <span class="hljs-number">18</span>, <span class="hljs-string">"テニスが趣味"</span>)<br><br>greeting(alexa)<br>greeting(hanako)<br></code></pre></td></tr></tbody></table></figure>
<p><code>greeting</code>関数は以下のような糖衣構文で記述することもできます。この記法は <strong>「コンテキスト境界」</strong> と呼ばれおり、型パラメータ<code>T</code>が型クラスとしての制約<code>CanGreet</code>を満たすという関係がより分かり易く記述できます<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>。</p>
<figure class="highlight scala"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">greeting2</span></span>[<span class="hljs-type">T</span>: <span class="hljs-type">CanGreet</span>](a: <span class="hljs-type">T</span>) = a.hello()<br></code></pre></td></tr></tbody></table></figure>


<h2 id="コンテキスト抽象化について、さらに知りたい方へ"><a href="#コンテキスト抽象化について、さらに知りたい方へ" class="headerlink" title="コンテキスト抽象化について、さらに知りたい方へ"></a>コンテキスト抽象化について、さらに知りたい方へ</h2><p>コンテキスト抽象化ではさらに以下のような高度な機能もあります。</p>
<ul>
<li>型クラスの導出(Type Class Derivation)</li>
<li>多元的等価性（Multiversal Equality)</li>
<li>コンテキスト関数(Context Functions)</li>
<li>暗黙の変換(Implicit Conversions)</li>
</ul>
<p>上記をもっと詳しく知りたい方は以下もご参照ください。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.scala-lang.org/scala3/book/ca-contextual-abstractions-intro.html">コンテキスト抽象化 - Scala 3 Book</a></li>
<li><a target="_blank" rel="noopener" href="https://dotty.epfl.ch/docs/reference/contextual/motivation.html">コンテキスト抽象化 - Scala 3 リファレンス</a></li>
</ul>
<h1 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h1><p>Contextual Abstractions(コンテキスト抽象化)について説明しました。コンテキスト抽象化の本質は <strong>「コンテキストの引き回し」に対するエレガントな回答</strong> であり、プログラムの<strong>疎結合化、柔軟性の向上、シンプル化</strong> に貢献します。さらに発展として <strong>「型のコンテキスト」を抽象化した「拡張メソッド」や「型クラス」にまで応用が広がっている強力な概念</strong> であり、プログラミングにおける有用な武器であることに疑う余地はありません。</p>
<p>「コンテキスト抽象化」という用語は恐らくScala 3で初めて出てきたものですが、内部の細かい機能は以前からある<code>Implicits</code>等の機能の再設計となっています。さすがに再設計だけあって恐らく Scala 3以外で<strong>ここまでコンテキスト抽象化について考えられているプログラミング言語はほとんどない</strong>ものと思われます。</p>
<p>ただし再設計といっても非常に多くの部分が見直されたり整理されたので <strong>従来の知識を前提とせず理解できるように</strong> 「コンテキスト」という概念から始めてイチから説明を積み上げています。本記事で用いたソースコードは以下のリポジトリの「<a target="_blank" rel="noopener" href="https://github.com/hinastory/scala3_dotty_examples/tree/master/src/main/scala/contextual_abstractions/examples">examples</a>」に登録してあるので興味がある方はご参照ください。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/hinastory/scala3_dotty_examples"><img src="https://gh-card.dev/repos/hinastory/scala3_dotty_examples.svg" alt="hinastory/scala3_dotty_examples - GitHub"></a></p>
<p>Scala 3は2021/2/17に3.0.0-RC1(リリース候補)が登場し、今年の前半から中盤にかけて正式リリースされる予定とアナウンスされています<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup>。コンテキスト抽象化以外にもScala 3では新機能が目白押しなので、リリースに向けて少しずつ機能をキャッチアップしていければと思っています。</p>
<p>本記事が、コンテキスト抽象化やScala 3に興味がある方の一助になれば幸いです。</p>
<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ul>
<li><a target="_blank" rel="noopener" href="https://docs.scala-lang.org/scala3/new-in-scala3.html">New in Scala 3</a><ul>
<li>Scala 3の新機能をさっとおさらいしたい人向けです。</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://docs.scala-lang.org/scala3/book/introduction.html">Scala 3 Book</a><ul>
<li>無料で読めるScala 3本です。現時点でScala 3に対して最も読みやすい資料だと思います。</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dotty.epfl.ch/docs/reference/overview.html">Scala 3 リファレンス</a><ul>
<li>Scala 3を全体を通して知りたい方は目を通してください。</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://qiita.com/hinastory/items/6dacb1f61d86f4a5d533">Scala3に入るかもしれないContextual Abstractionsを味見してみた(更新・追記あり) - Qiita</a><ul>
<li>過去にContextual Abstractionsを試したときの記事です。中身は最新の3.0.0-RC1にアップデートしてあります。</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://qiita.com/hinastory/items/abb68fe47755894b79ea">Scala 3、Pythonのようにインデントベースの構文で書けるようになるってよ！ - Qiita</a><ul>
<li>過去に書いたScala 3のインデントベースの構文の記事です。以前のScala 2をご存じの方でインデントベースの構文に違和感を覚えた人向けです。</li>
</ul>
</li>
</ul>
<div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none; padding-left: 0;"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">1.</span><span style="display: inline-block; vertical-align: top;">オブジェクト指向の「クラス」とはまったく関係ありません。</span><a href="#fnref:1" rev="footnote"> ↩</a></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">2.</span><span style="display: inline-block; vertical-align: top;">Rustをご存じの方であればコンテキスト境界はトレイト境界と似たようなものだと考えて貰えれば良いと思います。</span><a href="#fnref:2" rev="footnote"> ↩</a></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">3.</span><span style="display: inline-block; vertical-align: top;"><a target="_blank" rel="noopener" href="https://www.scala-lang.org/blog/2020/12/15/scala-3-crossing-the-finish-line.html">Scala 3 - Crossing the finish line | The Scala Programming Language</a></span><a href="#fnref:3" rev="footnote"> ↩</a></li></ol></div></div></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_hatena"></a><a class="a2a_button_reddit"></a></div><script async src="https://static.addtoany.com/menu/page.js"></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/cats-cats-cats/2021/02/22/access-analytics/"><span class="level-item">猫の日なので「cats cats cats」のGoogleアナリティクスとGoogleサーチコンソールの結果を晒してみる</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--><div><div class="popular-posts-box"><div class="popular-posts-box-title">関連する記事</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-img"><a href="/cats-cats-cats/2019/02/24/scala-dotty-contextual-abstractions/" title="Scala3に入るかもしれないContextual Abstractionsを味見してみた(更新・追記あり)" rel="bookmark"><img src="/cats-cats-cats/gallery/thumbnails/dotty-logo.png" /></a></div><div class="popular-posts-title"><h3><div class="popular-posts-date">2019-02-24</div><a href="/cats-cats-cats/2019/02/24/scala-dotty-contextual-abstractions/" title="Scala3に入るかもしれないContextual Abstractionsを味見してみた(更新・追記あり)" rel="bookmark">Scala3に入るかもしれないContextual Abstractionsを味見してみた(更新・追記あり)</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-img"><a href="/cats-cats-cats/2019/09/15/scala-indentation/" title="Scala 3、Pythonのようにインデントベースの構文で書けるようになるってよ！" rel="bookmark"><img src="/cats-cats-cats/gallery/thumbnails/dotty-logo.png" /></a></div><div class="popular-posts-title"><h3><div class="popular-posts-date">2019-09-15</div><a href="/cats-cats-cats/2019/09/15/scala-indentation/" title="Scala 3、Pythonのようにインデントベースの構文で書けるようになるってよ！" rel="bookmark">Scala 3、Pythonのようにインデントベースの構文で書けるようになるってよ！</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-img"><a href="/cats-cats-cats/2019/04/30/understanding-pattern-matching/" title="全プログラマに捧ぐ！図解「パターンマッチ」" rel="bookmark"><img src="/cats-cats-cats/gallery/daily/algorithm/pattern-match/pattern-01.png" /></a></div><div class="popular-posts-title"><h3><div class="popular-posts-date">2019-04-30</div><a href="/cats-cats-cats/2019/04/30/understanding-pattern-matching/" title="全プログラマに捧ぐ！図解「パターンマッチ」" rel="bookmark">全プログラマに捧ぐ！図解「パターンマッチ」</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-img"><a href="/cats-cats-cats/2019/07/04/scala-matsuri-2019/" title="ScalaMatsuri 2019に参加してきました" rel="bookmark"><img src="/cats-cats-cats/gallery/thumbnails/scala-matsuri-logo.png" /></a></div><div class="popular-posts-title"><h3><div class="popular-posts-date">2019-07-04</div><a href="/cats-cats-cats/2019/07/04/scala-matsuri-2019/" title="ScalaMatsuri 2019に参加してきました" rel="bookmark">ScalaMatsuri 2019に参加してきました</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-img"><a href="/cats-cats-cats/2020/02/11/scala3_programming_category/" title="Scala3と圏論とプログラミング" rel="bookmark"><img src="/cats-cats-cats/gallery/thumbnails/scala3_cats.png" /></a></div><div class="popular-posts-title"><h3><div class="popular-posts-date">2020-02-11</div><a href="/cats-cats-cats/2020/02/11/scala3_programming_category/" title="Scala3と圏論とプログラミング" rel="bookmark">Scala3と圏論とプログラミング</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-img"><a href="/cats-cats-cats/2019/07/20/learning-category-theory/" title="Scalaプログラマが圏論を学ぶためのオススメ文献 - 3選" rel="bookmark"><img src="/cats-cats-cats/gallery/profile/cats-cats-cats-logo.png" /></a></div><div class="popular-posts-title"><h3><div class="popular-posts-date">2019-07-20</div><a href="/cats-cats-cats/2019/07/20/learning-category-theory/" title="Scalaプログラマが圏論を学ぶためのオススメ文献 - 3選" rel="bookmark">Scalaプログラマが圏論を学ぶためのオススメ文献 - 3選</a></h3></div></li></ul></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最近の記事</h3><article class="media"><figure class="media-left"><a class="image" href="/cats-cats-cats/2021/03/16/contextual-abstructions/"><img src="/cats-cats-cats/gallery/thumbnails/eiga_film.png" alt="Contextual Abstractionsで様々なコンテキストをうまく抽象化する"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-03-15T22:28:45.000Z">2021-03-16</time></p><p class="title"><a href="/cats-cats-cats/2021/03/16/contextual-abstructions/">Contextual Abstractionsで様々なコンテキストをうまく抽象化する</a></p><p class="categories"><a href="/cats-cats-cats/categories/Tech/">Tech</a> / <a href="/cats-cats-cats/categories/Tech/Language/">Language</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/cats-cats-cats/2021/02/22/access-analytics/"><img src="/cats-cats-cats/gallery/profile/cats-cats-cats-logo.png" alt="猫の日なので「cats cats cats」のGoogleアナリティクスとGoogleサーチコンソールの結果を晒してみる"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-02-21T22:28:45.000Z">2021-02-22</time></p><p class="title"><a href="/cats-cats-cats/2021/02/22/access-analytics/">猫の日なので「cats cats cats」のGoogleアナリティクスとGoogleサーチコンソールの結果を晒してみる</a></p><p class="categories"><a href="/cats-cats-cats/categories/Tech/">Tech</a> / <a href="/cats-cats-cats/categories/Tech/Miscellaneous/">Miscellaneous</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/cats-cats-cats/2021/02/01/m1-mac-dev-env/"><img src="/cats-cats-cats/gallery/thumbnails/pose_necchuu_computer_man.png" alt="絶対にRosetta 2を入れてはいけないM1 Mac開発環境構築 2021-2-1版"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-01-31T22:28:45.000Z">2021-02-01</time></p><p class="title"><a href="/cats-cats-cats/2021/02/01/m1-mac-dev-env/">絶対にRosetta 2を入れてはいけないM1 Mac開発環境構築 2021-2-1版</a></p><p class="categories"><a href="/cats-cats-cats/categories/Tech/">Tech</a> / <a href="/cats-cats-cats/categories/Tech/Miscellaneous/">Miscellaneous</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/cats-cats-cats/2020/12/31/2020-last/"><img src="/cats-cats-cats/gallery/thumbnails/pose_furikaeru_man.png" alt="2020年の技術的な振り返り"></a></figure><div class="media-content"><p class="date"><time dateTime="2020-12-30T22:28:45.000Z">2020-12-31</time></p><p class="title"><a href="/cats-cats-cats/2020/12/31/2020-last/">2020年の技術的な振り返り</a></p><p class="categories"><a href="/cats-cats-cats/categories/Tech/">Tech</a> / <a href="/cats-cats-cats/categories/Tech/Miscellaneous/">Miscellaneous</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/cats-cats-cats/2020/12/08/serverless-workflow/"><img src="/cats-cats-cats/gallery/thumbnails/ts-sfn-cdk.png" alt="サーバーレスワークフローをTypeScriptで作成しよう 〜Step FunctionsとCDKによるLambdaの実行順序制御入門〜"></a></figure><div class="media-content"><p class="date"><time dateTime="2020-12-07T22:28:45.000Z">2020-12-08</time></p><p class="title"><a href="/cats-cats-cats/2020/12/08/serverless-workflow/">サーバーレスワークフローをTypeScriptで作成しよう 〜Step FunctionsとCDKによるLambdaの実行順序制御入門〜</a></p><p class="categories"><a href="/cats-cats-cats/categories/Tech/">Tech</a> / <a href="/cats-cats-cats/categories/Tech/CloudNative/">CloudNative</a></p></div></article></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">リンク</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://zenn.dev/hinastory" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Zenn - hinastory</span></span><span class="level-right"><span class="level-item tag">zenn.dev</span></span></a></li><li><a class="level is-mobile" href="https://qiita.com/hinastory" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Qiita - hinastory</span></span><span class="level-right"><span class="level-item tag">qiita.com</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">カテゴリ</h3><ul class="menu-list"><li><a class="level is-mobile" href="/cats-cats-cats/categories/DIY/"><span class="level-start"><span class="level-item">DIY</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/cats-cats-cats/categories/DIY/Keyboard/"><span class="level-start"><span class="level-item">Keyboard</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/cats-cats-cats/categories/Tech/"><span class="level-start"><span class="level-item">Tech</span></span><span class="level-end"><span class="level-item tag">50</span></span></a><ul><li><a class="level is-mobile" href="/cats-cats-cats/categories/Tech/Book/"><span class="level-start"><span class="level-item">Book</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/cats-cats-cats/categories/Tech/CloudNative/"><span class="level-start"><span class="level-item">CloudNative</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/cats-cats-cats/categories/Tech/ComputerScience/"><span class="level-start"><span class="level-item">ComputerScience</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/cats-cats-cats/categories/Tech/Event/"><span class="level-start"><span class="level-item">Event</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/cats-cats-cats/categories/Tech/Language/"><span class="level-start"><span class="level-item">Language</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/cats-cats-cats/categories/Tech/MachineLearning/"><span class="level-start"><span class="level-item">MachineLearning</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/cats-cats-cats/categories/Tech/Miscellaneous/"><span class="level-start"><span class="level-item">Miscellaneous</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/cats-cats-cats/categories/Tech/Web/"><span class="level-start"><span class="level-item">Web</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li></ul></div></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">アーカイブ</h3><ul class="menu-list"><li><a class="level is-mobile" href="/cats-cats-cats/archives/2021/03/"><span class="level-start"><span class="level-item">2021-03</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/cats-cats-cats/archives/2021/02/"><span class="level-start"><span class="level-item">2021-02</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/cats-cats-cats/archives/2020/"><span class="level-start"><span class="level-item">2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/cats-cats-cats/archives/2019/"><span class="level-start"><span class="level-item">2019</span></span><span class="level-end"><span class="level-item tag">35</span></span></a></li><li><a class="level is-mobile" href="/cats-cats-cats/archives/2018/"><span class="level-start"><span class="level-item">2018</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">タグ</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/AWS/"><span class="tag">AWS</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/AdventCalendar/"><span class="tag">AdventCalendar</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Algorithm/"><span class="tag">Algorithm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Azure/"><span class="tag">Azure</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Blog/"><span class="tag">Blog</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Book/"><span class="tag">Book</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/CDK/"><span class="tag">CDK</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/CategoryTheory/"><span class="tag">CategoryTheory</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Cats/"><span class="tag">Cats</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Certification/"><span class="tag">Certification</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Compiler/"><span class="tag">Compiler</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Container/"><span class="tag">Container</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Dotty/"><span class="tag">Dotty</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Environment/"><span class="tag">Environment</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/ErgoDash/"><span class="tag">ErgoDash</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Event/"><span class="tag">Event</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Exam/"><span class="tag">Exam</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/FizzBuzz/"><span class="tag">FizzBuzz</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Flourish/"><span class="tag">Flourish</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/GCP/"><span class="tag">GCP</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Git/"><span class="tag">Git</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Go/"><span class="tag">Go</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/IaC/"><span class="tag">IaC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Interpreter/"><span class="tag">Interpreter</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Jupyter/"><span class="tag">Jupyter</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Keras/"><span class="tag">Keras</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Keyboard/"><span class="tag">Keyboard</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Keymap/"><span class="tag">Keymap</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/M1/"><span class="tag">M1</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/MLOps/"><span class="tag">MLOps</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Mac/"><span class="tag">Mac</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/MachineLearning/"><span class="tag">MachineLearning</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/MakerFaire/"><span class="tag">MakerFaire</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Mind/"><span class="tag">Mind</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Minikube/"><span class="tag">Minikube</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/OGP/"><span class="tag">OGP</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Qiita/"><span class="tag">Qiita</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/ReView/"><span class="tag">ReView</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Ruby/"><span class="tag">Ruby</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Rust/"><span class="tag">Rust</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/SEO/"><span class="tag">SEO</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Scala/"><span class="tag">Scala</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Serverless/"><span class="tag">Serverless</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/StepFunctions/"><span class="tag">StepFunctions</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/TensorFlow/"><span class="tag">TensorFlow</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/TypeScript/"><span class="tag">TypeScript</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/WFH/"><span class="tag">WFH</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/Web/"><span class="tag">Web</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/WebAnalytics/"><span class="tag">WebAnalytics</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/gRPC/"><span class="tag">gRPC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/html5/"><span class="tag">html5</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/k8s/"><span class="tag">k8s</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/npm/"><span class="tag">npm</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/oEmbed/"><span class="tag">oEmbed</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/cats-cats-cats/tags/pulumi/"><span class="tag">pulumi</span><span class="tag">1</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div class="level"><figure class="level-item image is-64x64 mx-auto"><img class="avatar is-rounded" src="https://www.gravatar.com/avatar/1d029a154310d0edb970e8caaf5dc5ec?s=128" alt="hinastory"></figure><div class="level-item"><div><p class="title is-size-4 is-block ml-1" style="line-height:inherit;display:block;">hinastory</p><p class="is-size-6 is-flex justify-content-center ml-3"><i class="fas fa-map-marker-alt mr-1"></i><span>Kanagawa, Japan</span></p></div></div></div></div></nav><nav class="level is-mobile"><p class="is-size-6 is-block">The more you reason the less you create</p></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">投稿</p><a href="/cats-cats-cats/archives"><p class="title">54</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">カテゴリ</p><a href="/cats-cats-cats/categories"><p class="title">11</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">タグ</p><a href="/cats-cats-cats/tags"><p class="title">56</p></a></div></div></nav><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/hinastory/"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/hinastory999"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/cats-cats-cats/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目次</h3><ul class="menu-list"><li><a class="level is-mobile" href="#はじめに"><span class="level-left"><span class="level-item">1</span><span class="level-item">はじめに</span></span></a></li><li><a class="level is-mobile" href="#コンテキスト抽象化の基本"><span class="level-left"><span class="level-item">2</span><span class="level-item">コンテキスト抽象化の基本</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#コンテキスト"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">コンテキスト</span></span></a></li><li><a class="level is-mobile" href="#コンテキストの引き回し"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">コンテキストの引き回し</span></span></a></li><li><a class="level is-mobile" href="#コンテキストを型で分割する"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">コンテキストを型で分割する</span></span></a></li><li><a class="level is-mobile" href="#型によるコンテキストの特定-usingとgiven"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">型によるコンテキストの特定(usingとgiven)</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#usingとgivenにおける変数名の省略とsummonメソッド"><span class="level-left"><span class="level-item">2.4.1</span><span class="level-item">usingとgivenにおける変数名の省略とsummonメソッド</span></span></a></li></ul></li><li><a class="level is-mobile" href="#コンテキスト抽象化"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">コンテキスト抽象化</span></span></a></li></ul></li><li><a class="level is-mobile" href="#コンテキスト抽象化の高度な機能"><span class="level-left"><span class="level-item">3</span><span class="level-item">コンテキスト抽象化の高度な機能</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#特定の型にコンテキストを追加する（拡張メソッド）"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">特定の型にコンテキストを追加する（拡張メソッド）</span></span></a></li><li><a class="level is-mobile" href="#特定のコンテキストを持つ「型」を定義する（型クラス）"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">特定のコンテキストを持つ「型」を定義する（型クラス）</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#型クラスを受け取る関数"><span class="level-left"><span class="level-item">3.2.1</span><span class="level-item">型クラスを受け取る関数</span></span></a></li></ul></li><li><a class="level is-mobile" href="#コンテキスト抽象化について、さらに知りたい方へ"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">コンテキスト抽象化について、さらに知りたい方へ</span></span></a></li></ul></li><li><a class="level is-mobile" href="#まとめ"><span class="level-left"><span class="level-item">4</span><span class="level-item">まとめ</span></span></a></li><li><a class="level is-mobile" href="#参考文献"><span class="level-left"><span class="level-item">5</span><span class="level-item">参考文献</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/cats-cats-cats/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/cats-cats-cats/"><img src="/cats-cats-cats/gallery/profile/cats-cats-cats-logo.png" alt="cats cats cats" height="28"></a><p class="is-size-7"><span>&copy; 2021 hinastory</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("ja");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/cats-cats-cats/js/column.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><a id="back-to-top" title="トップに戻る" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/cats-cats-cats/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "このウェブサイトはあなたの経験を改善するためにCookieを使用しています。",
          dismiss: "了解しました",
          allow: "Cookiesを許可する",
          deny: "拒否する",
          link: "もっと詳しく知る",
          policy: "Cookieポリシー",
          href: "https://hinastory.github.io/cats-cats-cats/about/#%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E8%A7%A3%E6%9E%90%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="/cats-cats-cats/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="何かを入力してください..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/cats-cats-cats/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/cats-cats-cats/content.json"}, {"hint":"何かを入力してください...","untitled":"(無題)","posts":"投稿","pages":"ページ","categories":"カテゴリ","tags":"タグ"});
        });</script></body></html>